```sql
-- 상품 별 오프라인 매출 구하기
SELECT PRODUCT_CODE, SUM(PRICE * SALES_AMOUNT) AS SALES
FROM PRODUCT, OFFLINE_SALE
WHERE PRODUCT.PRODUCT_ID = OFFLINE_SALE.PRODUCT_ID
GROUP BY PRODUCT.PRODUCT_CODE
ORDER BY SALES DESC, PRODUCT_CODE ASC

-- 자동차 대여 기록 별 대여 금액 구하기
SELECT HIST.HISTORY_ID
    ,((100-NVL((
            SELECT MAX(DISCOUNT_RATE) 
            FROM CAR_RENTAL_COMPANY_DISCOUNT_PLAN PLAN 
            WHERE TO_NUMBER(SUBSTR(DURATION_TYPE, 1, INSTR(DURATION_TYPE, '일')-1 )) 
                    <= (TO_NUMBER(HIST.END_DATE - HIST.START_DATE)+1)
        AND PLAN.CAR_TYPE = CATLG.CAR_TYPE --'트럭'
    ),0)) * CATLG.DAILY_FEE / 100 * (TO_NUMBER(HIST.END_DATE - HIST.START_DATE)+1)) AS FEE
FROM CAR_RENTAL_COMPANY_CAR CATLG, CAR_RENTAL_COMPANY_RENTAL_HISTORY HIST  
WHERE 1=1
AND CATLG.CAR_ID = HIST.CAR_ID
AND CATLG.CAR_TYPE = '트럭'
ORDER BY FEE DESC, HIST.HISTORY_ID DESC

-- 자동차 평균 대여 기간 구하기
SELECT CAR_ID,	ROUND(AVG(TO_NUMBER(END_DATE - START_DATE)+1),1) AS AVERAGE_DURATION
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
group by CAR_ID
having ROUND(AVG(TO_NUMBER(END_DATE - START_DATE)+1),1) >= 7
order by AVERAGE_DURATION DESC, CAR_ID DESC

-- 대여 기록이 존재하는 자동차 리스트 구하기
SELECT DISTINCT CATLG.CAR_ID
FROM CAR_RENTAL_COMPANY_CAR CATLG, CAR_RENTAL_COMPANY_RENTAL_HISTORY HIST
WHERE CATLG.CAR_ID = HIST.CAR_ID
AND CATLG.CAR_TYPE = '세단'
AND TO_CHAR(START_DATE, 'MM') = '10'
ORDER BY CATLG.CAR_ID DESC

-- 자동차 대여 기록에서 대여중 / 대여 가능 여부 구분하기
SELECT CAR_ID,MAX(
    CASE WHEN '20221016' BETWEEN TO_CHAR(START_DATE, 'YYYYMMDD') AND TO_CHAR (END_DATE, 'YYYYMMDD') THEN '대여중'
    ELSE '대여 가능'
    END )AS AVAILABILITY
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY 
GROUP BY CAR_ID
ORDER BY CAR_ID DESC

-- 대여 횟수가 많은 자동차들의 월별 대여 횟수 구하기
SELECT TO_CHAR(START_DATE,'FMMM') AS MONTH,	CAR_ID, COUNT(*) AS RECORDS
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
WHERE CAR_ID IN (SELECT CAR_ID
    FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
    WHERE TO_CHAR(START_DATE,'YYYYMM') BETWEEN '202208' AND '202210'
    GROUP BY CAR_ID
    HAVING COUNT(*) >= 5
)
AND TO_CHAR(START_DATE,'YYYYMM') BETWEEN '202208' AND '202210'
GROUP BY CAR_ID, TO_CHAR(START_DATE,'FMMM')
ORDER BY TO_NUMBER(MONTH) ASC, CAR_ID DESC -- MONTH에 TO_NUMBER을 안걸면 숫자로 볼땐 10이지만 문자로 보면 1 vs 8이라 10이 먼저 오게 됨
```
